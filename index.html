<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>WIENER DOGE</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div class="doge-header">üå≠üê∂</div>
    <h1>WIENER DOGE</h1>
    <p class="tagline">Much app. Very mini. Wow.</p>

    <div id="user-greeting">Loading...</div>

    <div class="nav-buttons">
      <button onclick="goTo('profile.html')">üêï Profile</button>
      <button onclick="goTo('settings.html')">‚öôÔ∏è Settings</button>
    </div>

    <button class="main-btn" id="bark-btn">BARK!</button>
  </div>

  <script>
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    const user = Telegram.WebApp.initDataUnsafe.user;
    const greeting = document.getElementById('user-greeting');
    if (user) {
      greeting.textContent = `Hello, ${user.first_name || 'Doge'}!`;
    } else {
      greeting.textContent = 'Open in Telegram to see your name!';
    }

    document.getElementById('bark-btn').onclick = () => {
      Telegram.WebApp.HapticFeedback.impactOccurred('medium');
      Telegram.WebApp.showAlert('WOOF WOOF! üå≠üêï');
    };

    function goTo(page) {
      window.location.href = page;
    }

    Telegram.WebApp.enableClosingConfirmation();
  </script>
</body>
</html>            font-size: 14px;
            opacity: 0.8;
        }
        #game-area {
            flex: 1;
            width: 100%;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #dachshund {
            position: relative;
            width: 200px;
            height: 120px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 120"><ellipse cx="100" cy="70" rx="80" ry="35" fill="%23b5651d"/><ellipse cx="50" cy="65" rx="30" ry="25" fill="%23b5651d"/><circle cx="40" cy="60" r="12" fill="%23000"/><circle cx="43" cy="60" r="4" fill="%23fff"/><circle cx="140" cy="75" r="18" fill="%23b5651d"/><ellipse cx="160" cy="80" rx="25" ry="15" fill="%23b5651d"/><rect x="20" y="90" width="20" height="20" fill="%23b5651d" rx="3"/><rect x="45" y="90" width="20" height="20" fill="%23b5651d" rx="3"/><rect x="70" y="90" width="20" height="20" fill="%23b5651d" rx="3"/><rect x="95" y="90" width="20" height="20" fill="%23b5651d" rx="3"/><rect x="120" y="90" width="20" height="20" fill="%23b5651d" rx="3"/><rect x="145" y="90" width="20" height="20" fill="%23b5651d" rx="3"/><rect x="170" y="90" width="20" height="20" fill="%23b5651d" rx="3"/></svg>') no-repeat center;
            background-size: contain;
            cursor: pointer;
            transition: transform 0.1s;
            z-index: 10;
        }
        #dachshund:active {
            transform: scale(0.95);
        }
        .coin {
            position: absolute;
            font-size: 20px;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
            color: #ffd700;
            text-shadow: 1px 1px 2px #000;
            z-index: 5;
        }
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-60px); opacity: 0; }
        }
        #tap-effect {
            position: absolute;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(255,255,255,0.7) 10%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            transform: scale(0);
            animation: tapPulse 0.3s ease-out;
            z-index: 5;
        }
        @keyframes tapPulse {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        #upgrades {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-around;
            z-index: 20;
        }
        .upgrade-btn {
            background: rgba(0,0,0,0.3);
            border: 1px solid #fff;
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .upgrade-btn:hover, .upgrade-btn.active {
            background: rgba(0,0,0,0.5);
        }
        .upgrade-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        #tabs {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            z-index: 20;
        }
        .tab-btn {
            background: rgba(0,0,0,0.3);
            border: 1px solid #fff;
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .tab-btn.active {
            background: rgba(0,0,0,0.5);
        }
        #tasks, #friends, #stats {
            position: absolute;
            top: 60px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            max-width: 250px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            color: #fff;
            font-size: 12px;
        }
        #tasks.active, #friends.active, #stats.active {
            display: block;
        }
        .task-item, .friend-item, .stat-item {
            padding: 5px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
        }
        .task-item:last-child, .friend-item:last-child, .stat-item:last-child {
            border-bottom: none;
        }
        #footer {
            padding: 10px;
            font-size: 12px;
            text-align: center;
            background: rgba(0,0,0,0.2);
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="header">
        <div id="score">0 $WIENER</div>
        <div id="level">CEO Level 1</div>
    </div>
    <div id="tabs">
        <div class="tab-btn active" data-tab="game">Game</div>
        <div class="tab-btn" data-tab="tasks">Tasks</div>
        <div class="tab-btn" data-tab="friends">Friends</div>
        <div class="tab-btn" data-tab="stats">Stats</div>
    </div>
    <div id="game-area">
        <div id="dachshund"></div>
        <div id="tap-effect"></div>
    </div>
    <div id="upgrades">
        <button class="upgrade-btn" id="mine-upgrade">Mine Lv.1 (Cost: 100)</button>
        <button class="upgrade-btn" id="cooling-upgrade">Cooling Lv.1 (Cost: 150)</button>
        <button class="upgrade-btn" id="legal-upgrade">Legal Lv.1 (Cost: 200)</button>
    </div>
    <div id="tasks">
        <h3>Daily Tasks</h3>
        <div class="task-item" data-reward="500">Join Telegram Channel (+500 $WIENER)</div>
        <div class="task-item" data-reward="1000">Invite 1 Friend (+1000 $WIENER)</div>
        <div class="task-item" data-reward="2000">Watch Ad (+2000 $WIENER)</div>
    </div>
    <div id="friends">
        <h3>Your Friends</h3>
        <div class="friend-item">Friend1: 1500 $WIENER</div>
        <div class="friend-item">Friend2: 2300 $WIENER</div>
        <p>Invite more for bonuses!</p>
    </div>
    <div id="stats">
        <h3>Statistics</h3>
        <div class="stat-item">Total Taps: <span id="total-taps">0</span></div>
        <div class="stat-item">Total Earned: <span id="total-earned">0</span> $WIENER</div>
        <div class="stat-item">Level: <span id="current-level">1</span></div>
    </div>
    <div id="footer">Wiener Kombat ¬© 2025 | Powered by TON</div>

    <script>
        // Telegram WebApp integration
        const tg = window.Telegram?.WebApp || {};
        if (tg.initData) {
            tg.ready();
            tg.expand();
        }

        const scoreElement = document.getElementById('score');
        const levelElement = document.getElementById('level');
        const dachshund = document.getElementById('dachshund');
        const gameArea = document.getElementById('game-area');
        const tapEffect = document.getElementById('tap-effect');

        let score = 0;
        let totalTaps = 0;
        let totalEarned = 0;
        let level = 1;
        let passiveIncome = 0;
        let mineLevel = 1;
        let coolingLevel = 1;
        let legalLevel = 1;

        const upgrades = {
            mine: { level: 1, cost: 100, income: 1 },
            cooling: { level: 1, cost: 150, income: 0 },
            legal: { level: 1, cost: 200, income: 0 }
        };

        // Update display
        function updateDisplay() {
            scoreElement.textContent = Math.floor(score) + ' $WIENER';
            levelElement.textContent = `CEO Level ${level}`;
            document.getElementById('total-taps').textContent = totalTaps;
            document.getElementById('total-earned').textContent = Math.floor(totalEarned);
            document.getElementById('current-level').textContent = level;

            // Update upgrade buttons
            document.getElementById('mine-upgrade').textContent = `Mine Lv.${upgrades.mine.level} (Cost: ${upgrades.mine.cost})`;
            document.getElementById('cooling-upgrade').textContent = `Cooling Lv.${upgrades.cooling.level} (Cost: ${upgrades.cooling.cost})`;
            document.getElementById('legal-upgrade').textContent = `Legal Lv.${upgrades.legal.level} (Cost: ${upgrades.legal.cost})`;

            // Enable/disable buttons
            Object.keys(upgrades).forEach(key => {
                const btn = document.getElementById(key + '-upgrade');
                btn.disabled = score < upgrades[key].cost;
            });

            // Passive income
            passiveIncome = (upgrades.mine.level * 1) + (upgrades.cooling.level * 2) + (upgrades.legal.level * 3);
            score += passiveIncome / 3600; // Per second, assuming 60fps
        }

        // Tap handler
        dachshund.addEventListener('click', (e) => {
            const tapValue = 1 + (level * 0.1) + (upgrades.mine.level * 0.5);
            score += tapValue;
            totalTaps++;
            totalEarned += tapValue;

            // Haptic feedback
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');

            // Visual effects
            const effect = tapEffect.cloneNode(true);
            effect.style.left = (e.clientX - 40) + 'px';
            effect.style.top = (e.clientY - 40) + 'px';
            gameArea.appendChild(effect);
            setTimeout(() => effect.remove(), 300);

            const coin = document.createElement('div');
            coin.className = 'coin';
            coin.textContent = '+' + Math.floor(tapValue);
            coin.style.left = (e.clientX - 10) + 'px';
            coin.style.top = (e.clientY - 10) + 'px';
            document.body.appendChild(coin);
            setTimeout(() => coin.remove(), 800);

            // Level up
            if (score > level * 1000) {
                level++;
            }

            updateDisplay();
        });

        // Upgrade handlers
        document.getElementById('mine-upgrade').addEventListener('click', () => buyUpgrade('mine'));
        document.getElementById('cooling-upgrade').addEventListener('click', () => buyUpgrade('cooling'));
        document.getElementById('legal-upgrade').addEventListener('click', () => buyUpgrade('legal'));

        function buyUpgrade(type) {
            const up = upgrades[type];
            if (score >= up.cost) {
                score -= up.cost;
                up.level++;
                up.cost = Math.floor(up.cost * 1.5);
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                updateDisplay();
            }
        }

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                document.querySelectorAll('#tasks, #friends, #stats').forEach(el => el.classList.remove('active'));
                const tab = btn.dataset.tab;
                if (tab !== 'game') {
                    document.getElementById(tab + 's').classList.add('active');
                }
            });
        });

        // Task handlers
        document.querySelectorAll('.task-item').forEach(item => {
            item.addEventListener('click', () => {
                const reward = parseInt(item.dataset.reward);
                score += reward;
                totalEarned += reward;
                item.style.opacity = '0.5';
                item.style.textDecoration = 'line-through';
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                updateDisplay();
            });
        });

        // Game loop
        function gameLoop() {
            updateDisplay();
            requestAnimationFrame(gameLoop);
        }

        // Initialize
        updateDisplay();
        gameLoop();

        // Auto-save (console for demo)
        setInterval(() => {
            console.log('Current Score:', Math.floor(score), 'Level:', level);
            // In real app, send to backend via TG Cloud Storage or API
        }, 10000);
    </script>
</body>
</html>            flex: 1;
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        #dachshund {
            position: absolute;
            width: 120px;
            height: 80px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 80"><ellipse cx="60" cy="50" rx="50" ry="25" fill="%23b5651d"/><ellipse cx="30" cy="45" rx="20" ry="18" fill="%23b5651d"/><circle cx="20" cy="40" r="8" fill="%23000"/><circle cx="23" cy="40" r="3" fill="%23fff"/><circle cx="85" cy="55" r="12" fill="%23b5651d"/><ellipse cx="100" cy="60" rx="18" ry="12" fill="%23b5651d"/><rect x="10" y="60" width="15" height="15" fill="%23b5651d" rx="2"/><rect x="35" y="60" width="15" height="15" fill="%23 conosce1d" rx="2"/><rect x="60" y="60" width="15" height="15" fill="%23b5651d" rx="2"/><rect x="85" y="60" width="15" height="15" fill="%23b5651d" rx="2"/></svg>') no-repeat center;
            background-size: contain;
            cursor: pointer;
            transition: transform 0.1s;
            z-index: 10;
        }
        #dachshund:active {
            transform: scale(0.9);
        }
        .coin {
            position: absolute;
            font-size: 24px;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
            color: #ffd700;
            text-shadow: 1px 1px 2px #000;
        }
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-80px); opacity: 0; }
        }
        #tap-effect {
            position: absolute;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 10%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            transform: scale(0);
            animation: tapPulse 0.4s ease-out;
            z-index: 5;
        }
        @keyframes tapPulse {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        #footer {
            padding: 15px;
            font-size: 14px;
            text-align: center;
            background: rgba(0,0,0,0.1);
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="header">
        <div id="score">$WIENER: 0</div>
        <div>Tap the Dachshund!</div>
    </div>
    <div id="game-area">
        <div id="dachshund"></div>
    </div>
    <div id="footer">Weiner Game ¬© 2025</div>

    <script>
        // Telegram WebApp integration
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        const scoreElement = document.getElementById('score');
        const dachshund = document.getElementById('dachshund');
        const gameArea = document.getElementById('game-area');

        let score = 0;
        let isMoving = false;

        // Random position for dachshund
        function moveDachshund() {
            if (isMoving) return;
            isMoving = true;

            const maxX = gameArea.clientWidth - 120;
            const maxY = gameArea.clientHeight - 80;
            const x = Math.random() * maxX;
            const y = Math.random() * maxY;

            dachshund.style.left = x + 'px';
            dachshund.style.top = y + 'px';

            setTimeout(() => {
                isMoving = false;
            }, 300);
        }

        // Initial position
        moveDachshund();
        setInterval(moveDachshund, 3000); // Move every 3 seconds

        // Tap handler
        dachshund.addEventListener('click', (e) => {
            // Prevent multiple rapid clicks
            if (isMoving) return;

            // Increment score
            score += 1;
            scoreElement.textContent = `$WIENER: ${score}`;

            // Haptic feedback
            tg.HapticFeedback.impactOccurred('light');

            // Visual tap effect
            const tap = document.createElement('div');
            tap.className = 'tap-effect';
            tap.style.left = (e.clientX - 30) + 'px';
            tap.style.top = (e.clientY - 30) + 'px';
            document.body.appendChild(tap);
            setTimeout(() => tap.remove(), 400);

            // Floating $WIENER
            const coin = document.createElement('div');
            coin.className = 'coin';
            coin.textContent = '+$1';
            coin.style.left = (e.clientX - 15) + 'px';
            coin.style.top = (e.clientY - 20) + 'px';
            document.body.appendChild(coin);
            setTimeout(() => coin.remove(), 1000);

            // Move immediately after tap
            setTimeout(moveDachshund, 100);
        });

        // Optional: Auto-save score to Telegram (using initData)
        setInterval(() => {
            if (score > 0) {
                // In a real game, you'd send this to your backend
                console.log('Score:', score);
            }
        }, 5000);
    </script>
</body>
</html>    <img src="https://i.imgur.com/8pZ3i0E.png" 
         id="wiener-img" 
         onclick="tapWiener()"
         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSJ5ZWxsb3ciLz48dGV4dCB4PSI1MCIgeT0iMTE1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iNDAiIGZpbGw9ImJsYWNrIj7wn5GBrDwvdGV4dD48L3N2Zz4='">
    <div class="stat">Points: <span id="points">0.0</span></div>
    <div class="stat">Miners: <span id="miners">0</span> (+<span id="miner-income">0</span>/s)</div>
    <div class="nav">
      <button class="btn" onclick="showPage('upgrades')">Upgrades</button>
      <button class="btn" onclick="showPage('daily')">Daily</button>
      <button class="btn" onclick="showPage('refer')">Refer</button>
      <button class="btn" onclick="showPage('shop')">Shop</button>
      <button class="btn" onclick="showPage('spin')">Spin</button>
      <button class="btn" onclick="showPage('leaderboard')">Leaderboard</button>
    </div>
  </div>

  <div id="upgrades" class="page">
    <h1>Upgrades</h1>
    <div id="upgrades-list"></div>
    <button class="btn" onclick="showPage('home')">Back</button>
  </div>

  <div id="daily" class="page">
    <h1>Daily Check-in</h1>
    <button class="btn" id="daily-btn" onclick="claimDaily()">Claim +10</button>
    <div>Streak: <span id="streak">0</span></div>
    <button class="btn" onclick="showPage('home')">Back</button>
  </div>

  <div id="refer" class="page">
    <h1>Refer & Earn</h1>
    <div id="referral-link">https://t.me/WienerClickerBot?start=ref_<span id="user-id"></span></div>
    <button class="btn" onclick="copyReferral()">Copy Link</button>
    <button class="btn" onclick="showPage('home')">Back</button>
  </div>

  <div id="shop" class="page">
    <h1>Shop</h1>
    <div style="margin:10px;padding:15px;background:rgba(255,255,255,0.1);border-radius:15px;">
      L1 Miner: 1000 ‚Üí +50/day <button class="btn" onclick="buyMiner(1)">Buy</button>
    </div>
    <button class="btn" onclick="showPage('home')">Back</button>
  </div>

  <div id="spin" class="page">
    <h1>Lucky Spin</h1>
    <button class="btn" id="spin-btn" onclick="doSpin()">SPIN (100)</button>
    <div id="spin-result" style="margin:20px;font-size:20px;color:#ffd700;"></div>
    <button class="btn" onclick="showPage('home')">Back</button>
  </div>

  <div id="leaderboard" class="page">
    <h1>Leaderboard</h1>
    <ul id="leaderboard-list"></ul>
    <button class="btn" onclick="showPage('home')">Back</button>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;
    if (tg) tg.ready();

    // Game state
    let game = { 
      points: 0, 
      miners: {1: 0}, 
      lastDaily: '', 
      streak: 0,
      level: 1,
      exp: 0,
      totalPoints: 0,
      userId: tg?.initDataUnsafe?.user?.id || 'test',
      referrals: 0
    };
    let els = {};
    let autoMineInterval;

    // Sound effects (base64 encoded short MP3s - replace with actual if needed)
    const sounds = {
      tap: new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhAA'), // Short click sound
      buy: new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhAA'), // Success sound
      win: new Audio('data:audio/wav;base64,UklGRp4CAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhAA'), // Win jingle
      spin: new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhAA') // Spin sound
    };

    function playSound(type) {
      if (sounds[type]) {
        sounds[type].currentTime = 0;
        sounds[type].play().catch(() => {}); // Ignore play errors
      }
    }

    // Upgrades data
    const upgrades = [
      { id: 1, name: 'Tap Booster', desc: '+0.2 per tap', cost: 100, baseCost: 100, owned: 0, effect: () => game.tapMultiplier = (game.tapMultiplier || 1) + 0.2 },
      { id: 2, name: 'Auto Tapper', desc: '+1 auto/sec', cost: 500, baseCost: 500, owned: 0, effect: () => game.autoTap = (game.autoTap || 0) + 1 },
      { id: 3, name: 'Exp Booster', desc: '+20% exp gain', cost: 200, baseCost: 200, owned: 0, effect: () => game.expMultiplier = (game.expMultiplier || 1) * 1.2 }
    ];

    function init() {
      els = {
        loading: document.getElementById('loading'),
        home: document.getElementById('home'),
        points: document.getElementById('points'),
        miners: document.getElementById('miners'),
        minerIncome: document.getElementById('miner-income'),
        dailyBtn: document.getElementById('daily-btn'),
        streak: document.getElementById('streak'),
        spinBtn: document.getElementById('spin-btn'),
        spinResult: document.getElementById('spin-result'),
        level: document.getElementById('level'),
        userId: document.getElementById('user-id'),
        upgradesList: document.getElementById('upgrades-list'),
        leaderboardList: document.getElementById('leaderboard-list')
      };

      els.userId.innerText = game.userId;

      // Load saved game
      if (tg?.CloudStorage) {
        tg.CloudStorage.getItem('wienerDoge', (err, saved) => {
          if (saved) {
            try { game = { ...game, ...JSON.parse(saved) }; } catch(e) { console.error('Parse error:', e); }
          }
          finishLoading();
        });
        // Load leaderboard
        tg.CloudStorage.getItem('leaderboard', (err, lb) => {
          if (lb) leaderboardData = JSON.parse(lb);
          updateLeaderboard();
        });
      } else {
        setTimeout(finishLoading, 300);
      }

      // Start auto mining
      startAutoMine();
    }

    function finishLoading() {
      els.loading.style.display = 'none';
      els.home.classList.add('active');
      update();
      checkDaily();
      updateUpgrades();
      updateLeaderboard();
    }

    function tapWiener() {
      const gain = 0.1 * (game.tapMultiplier || 1);
      game.points += gain;
      game.totalPoints += gain;
      game.exp += gain * (game.expMultiplier || 1);
      checkLevelUp();
      playSound('tap');
      update(); save();
    }

    function buyMiner(lvl) {
      const cost = 1000;
      if (game.points >= cost) {
        game.points -= cost;
        game.miners[lvl] = (game.miners[lvl] || 0) + 1;
        playSound('buy');
        update(); save();
      } else {
        alert("Not enough points!");
      }
    }

    function buyUpgrade(id) {
      const upgrade = upgrades.find(u => u.id === id);
      if (!upgrade || game.points < upgrade.cost) {
        alert("Not enough points!");
        return;
      }
      game.points -= upgrade.cost;
      upgrade.owned++;
      upgrade.cost = Math.floor(upgrade.baseCost * Math.pow(1.15, upgrade.owned));
      upgrade.effect();
      playSound('buy');
      updateUpgrades();
      update();
      save();
    }

    function claimDaily() {
      const today = new Date().toDateString();
      if (game.lastDaily !== today) {
        game.points += 10;
        game.streak++;
        game.lastDaily = today;
        els.dailyBtn.disabled = true;
        els.dailyBtn.innerText = "Claimed";
        playSound('buy');
        update(); save();
      }
    }

    function checkDaily() {
      const today = new Date().toDateString();
      els.streak.innerText = game.streak;
      if (game.lastDaily === today) {
        els.dailyBtn.disabled = true;
        els.dailyBtn.innerText = "Claimed";
      } else {
        els.dailyBtn.disabled = false;
        els.dailyBtn.innerText = "Claim +10";
      }
    }

    function doSpin() {
      if (game.points < 100) {
        alert("Need 100 points!");
        return;
      }
      game.points -= 100;
      playSound('spin');
      els.spinBtn.disabled = true;
      els.spinResult.innerText = "Spinning...";
      update();

      setTimeout(() => {
        const win = Math.random() < 0.2 
          ? (Math.random() < 0.25 ? 500 : 50) 
          : 0;
        game.points += win;
        game.exp += win * (game.expMultiplier || 1);
        checkLevelUp();
        els.spinResult.innerText = win ? `+${win}!` : "No luck!";
        if (win) playSound('win');
        els.spinBtn.disabled = false;
        update(); save();
      }, 2000);
    }

    function copyReferral() {
      const link = document.getElementById('referral-link').innerText;
      if (tg?.showPopup) {
        tg.showPopup({
          title: 'Referral Link',
          message: link,
          buttons: [{ type: 'copy', text: 'Copy' }]
        }, (btn) => {
          if (btn === 'copy') {
            navigator.clipboard.writeText(link);
          }
        });
      } else {
        alert('Link copied: ' + link);
        navigator.clipboard.writeText(link).catch(() => {});
      }
    }

    function update() {
      els.points.innerText = game.points.toFixed(1);
      const totalMiners = Object.values(game.miners).reduce((a,b) => a + b, 0);
      els.miners.innerText = totalMiners;
      els.minerIncome.innerText = totalMiners * 50 / 86400; // Approx per sec
      els.level.innerText = game.level;
    }

    function updateUpgrades() {
      els.upgradesList.innerHTML = upgrades.map(u => `
        <div class="upgrade-item">
          <h2>${u.name} (Owned: ${u.owned})</h2>
          <p>${u.desc}</p>
          <button class="btn" onclick="buyUpgrade(${u.id})" ${game.points < u.cost ? 'disabled' : ''}>Buy: ${u.cost}</button>
        </div>
      `).join('');
    }

    function checkLevelUp() {
      const requiredExp = game.level * 100;
      if (game.exp >= requiredExp) {
        game.level++;
        game.exp = 0;
        alert(`Level up! Now level ${game.level}!`);
        // Bonus points on level up
        game.points += 50;
        update();
        save();
      }
    }

    function startAutoMine() {
      clearInterval(autoMineInterval);
      autoMineInterval = setInterval(() => {
        if (game.miners) {
          const income = Object.values(game.miners).reduce((a, b) => a + b, 0) * 50 / 86400; // Daily to per sec
          game.points += income * (game.autoTap || 0); // Use autoTap if exists
          game.totalPoints += income * (game.autoTap || 0);
          game.exp += income * (game.autoTap || 0) * (game.expMultiplier || 1);
          checkLevelUp();
          update();
          save();
        }
      }, 1000);
    }

    function save() {
      if (tg?.CloudStorage) {
        tg.CloudStorage.setItem('wienerDoge', JSON.stringify(game));
        // Update leaderboard (top 10 by totalPoints)
        updateLeaderboard();
      }
    }

    let leaderboardData = [];

    function updateLeaderboard() {
      if (tg?.CloudStorage) {
        tg.CloudStorage.getItem('leaderboard', (err, lb) => {
          leaderboardData = lb ? JSON.parse(lb) : [];
          // Add/update current user
          const userIndex = leaderboardData.findIndex(u => u.userId === game.userId);
          const userData = { userId: game.userId, totalPoints: game.totalPoints, level: game.level };
          if (userIndex > -1) {
            leaderboardData[userIndex] = userData;
          } else {
            leaderboardData.push(userData);
          }
          // Sort by totalPoints desc, top 10
          leaderboardData.sort((a, b) => b.totalPoints - a.totalPoints);
          leaderboardData = leaderboardData.slice(0, 10);
          // Save back
          tg.CloudStorage.setItem('leaderboard', JSON.stringify(leaderboardData));
          // Render
          renderLeaderboard();
        });
      } else {
        // Mock for testing
        leaderboardData = [{userId: game.userId, totalPoints: game.totalPoints, level: game.level}];
        renderLeaderboard();
      }
    }

    function renderLeaderboard() {
      els.leaderboardList.innerHTML = leaderboardData.map((u, i) => `
        <li ${u.userId === game.userId ? 'class="me"' : ''}>
          #${i+1} ${u.userId} - ${u.totalPoints.toFixed(1)} pts (Lv${u.level})
        </li>
      `).join('');
    }

    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if (id === 'upgrades') updateUpgrades();
      if (id === 'leaderboard') updateLeaderboard();
    }

    // Start when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>      <button class="btn" onclick="showPage('refer')">Refer</button>
      <button class="btn" onclick="showPage('shop')">Shop</button>
      <button class="btn" onclick="showPage('spin')">Spin</button>
    </div>
  </div>

  <div id="daily" class="page">
    <h1>Daily Check-in</h1>
    <button class="btn" id="daily-btn" onclick="claimDaily()">Claim +10</button>
    <div>Streak: <span id="streak">0</span></div>
    <button class="btn" onclick="showPage('home')">Back</button>
  </div>

  <div id="refer" class="page">
    <h1>Refer & Earn</h1>
    <div id="referral-link">https://t.me/WienerClickerBot</div>
    <button class="btn" onclick="alert('Link copied!')">Copy</button>
    <button class="btn" onclick="showPage('home')">Back</button>
  </div>

  <div id="shop" class="page">
    <h1>Shop</h1>
    <div style="margin:10px;padding:15px;background:rgba(255,255,255,0.1);border-radius:15px;">
      L1: 1000 ‚Üí +50/day <button class="btn" onclick="buyMiner(1)">Buy</button>
    </div>
    <button class="btn" onclick="showPage('home')">Back</button>
  </div>

  <div id="spin" class="page">
    <h1>Lucky Spin</h1>
    <button class="btn" id="spin-btn" onclick="doSpin()">SPIN (100)</button>
    <div id="spin-result" style="margin:20px;font-size:20px;color:#ffd700;"></div>
    <button class="btn" onclick="showPage('home')">Back</button>
  </div>

  <script>
    // Hide loading when ready
    const tg = window.Telegram?.WebApp;

let game = { points: 0, miners: {1: 0}, lastDaily: '', streak: 0 };
const els = { /* ... your elements ... */ };

function init() {
  if (tg) {
    tg.ready();
    if (tg.CloudStorage) {
      tg.CloudStorage.getItem('wienerDoge', (err, saved) => {
        if (saved) {
          try { game = JSON.parse(saved); } catch(e) {}
        }
        finishLoading();
      });
    } else {
      setTimeout(finishLoading, 300);
    }
  } else {
    setTimeout(finishLoading, 300);
  }
}

function finishLoading() {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('home').classList.add('active');
  update();
  checkDaily();
}

// Start
init();

    const tg = window.Telegram?.WebApp;
    if (tg) tg.ready();

    let game = {points:0, miners:{1:0}, lastDaily:'', streak:0};

    const els = {
      points: document.getElementById('points'),
      miners: document.getElementById('miners'),
      dailyBtn: document.getElementById('daily-btn'),
      streak: document.getElementById('streak'),
      spinBtn: document.getElementById('spin-btn'),
      spinResult: document.getElementById('spin-result')
    };

    // Load
    if (tg?.CloudStorage) {
      tg.CloudStorage.getItem('wienerDoge', (err, data) => {
        if (data) game = JSON.parse(data);
        update(); checkDaily();
      });
    }

    function tapWiener() {
      game.points += 0.1;
      update(); save();
    }

    function buyMiner(lvl) {
      const cost = 1000;
      if (game.points >= cost) {
        game.points -= cost;
        game.miners[lvl] = (game.miners[lvl] || 0) + 1;
        update(); save();
      }
    }

    function claimDaily() {
      const today = new Date().toDateString();
      if (game.lastDaily !== today) {
        game.points += 10;
        game.streak++;
        game.lastDaily = today;
        els.dailyBtn.disabled = true;
        els.dailyBtn.innerText = "Claimed";
        update(); save();
      }
    }

    function checkDaily() {
      const today = new Date().toDateString();
      els.streak.innerText = game.streak;
      if (game.lastDaily === today) {
        els.dailyBtn.disabled = true;
        els.dailyBtn.innerText = "Claimed";
      }
    }

    function doSpin() {
      if (game.points < 100) return alert("Need 100!");
      game.points -= 100;
      els.spinBtn.disabled = true;
      setTimeout(() => {
        const win = Math.random() < 0.2 ? (Math.random() < 0.25 ? 500 : 50) : 0;
        game.points += win;
        els.spinResult.innerText = win ? `+${win}!` : "No luck";
        els.spinBtn.disabled = false;
        update(); save();
      }, 2000);
    }

    function update() {
      els.points.innerText = game.points.toFixed(1);
      els.miners.innerText = Object.values(game.miners).reduce((a,b)=>a+b,0);
    }

    function save() {
      if (tg?.CloudStorage) tg.CloudStorage.setItem('wienerDoge', JSON.stringify(game));
    }

    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    // Init
    update();
  </script>
</body>
</html>
      <button class="btn" onclick="showPage('refer')">Refer</button>
      <button class="btn" onclick="showPage('shop')">Shop</button>
      <button class="btn" onclick="showPage('spin')">Spin</button>
    </div>
  </div>

  <div id="daily" class="page">
    <h1>Daily Check-in</h1>
    <button class="btn" id="daily-btn" onclick="claimDaily()">Claim +10</button>
    <div>Streak: <span id="streak">0</span></div>
    <button class="btn" onclick="showPage('home')">Back</button>
  </div>

  <div id="refer" class="page">
    <h1>Refer & Earn</h1>
    <div id="referral-link">https://t.me/WienerClickerBot</div>
    <button class="btn" onclick="alert('Link copied!')">Copy</button>
    <button class="btn" onclick="showPage('home')">Back</button>
  </div>

  <div id="shop" class="page">
    <h1>Shop</h1>
    <div style="margin:10px;padding:15px;background:rgba(255,255,255,0.1);border-radius:15px;">
      L1: 1000 ‚Üí +50/day <button class="btn" onclick="buyMiner(1)">Buy</button>
    </div>
    <button class="btn" onclick="showPage('home')">Back</button>
  </div         onclick="tapWiener()"
         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjgwIiBmaWxsPSJ5ZWxsb3ciLz48dGV4dCB4PSI1MCIgeT0iMTE1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iNDAiIGZpbGw9ImJsYWNrIj7wn5GBrDwvdGV4dD48L3N
  <!-- HOME -->
  <div id="home" class="page active">
    <h1>WIENER DOGE</h1>
    <img src="https://i.ibb.co/4p4Y7hZ/wiener-cosmic-dachshund.png" id="wiener-img" onclick="tapWiener()">
    <div class="stat">
      <div>WIENER Points: <span id="points">0.0</span></div>
      <div>Miners: <span id="miners">0</span></div>
    </div>
    <div class="mining">
      <span>Today's Mining: </span><span id="points-earned">0.0</span>
    </div>
    <div class="nav">
      <button class="btn" onclick="showPage('daily')">Daily (+10)</button>
      <button class="btn" onclick="showPage('refer')">Refer (+50)</button>
      <button class="btn" onclick="showPage('shop')">Shop</button>
      <button class="btn" onclick="showPage('spin')">Lucky Spin</button>
    </div>
  </div>

  <!-- DAILY -->
  <div id="daily" class="page">
    <h1>Daily Check-in</h1>
    <img src="https://i.ibb.co/4p4Y7hZ/wiener-cosmic-dachshund.png" style="width:150px;height:150px;border-radius:50%;">
    <button class="btn" id="daily-btn" onclick="claimDaily()">Claim +10 Points!</button>
    <div id="daily-streak">Streak: <span id="streak">0</span> days</div>
    <button class="btn" onclick="showPage('home')">Back Home</button>
  </div>

  <!-- REFER -->
  <div id="refer" class="page">
    <h1>Refer & Earn</h1>
    <img src="https://i.ibb.co/4p4Y7hZ/wiener-cosmic-dachshund.png" style="width:150px;height:150px;border-radius:50%;">
    <p>Share ‚Üí +50 pts per friend!</p>
    <div id="referral-link">Loading...</div>
    <button class="btn" onclick="copyReferral()">Copy</button>
    <button class="btn" onclick="shareReferral()">Share</button>
    <button class="btn" onclick="showPage('home')">Back Home</button>
  </div>

  <!-- SHOP -->
  <div id="shop" class="page">
    <h1>Wiener Shop</h1>
    <img src="https://i.ibb.co/4p4Y7hZ/wiener-cosmic-dachshund.png" style="width:120px;height:120px;border-radius:50%;">
    <div class="shop-item">
      <strong>L1 Wiener</strong> ‚Äì 1000 pts ‚Üí +50/day<br>
      <button class="btn" onclick="buyMiner(1)">Buy</button>
    </div>
    <div class="shop-item">
      <strong>L2 Wiener</strong> ‚Äì 5000 pts ‚Üí +100/day<br>
      <button class="btn" onclick="buyMiner(2)">Buy</button>
    </div>
    <div class="shop-item">
      <strong>L3 Wiener</strong> ‚Äì 10,000 pts ‚Üí +200/day<br>
      <button class="btn" onclick="buyMiner(3)">Buy</button>
    </div>
    <div class="shop-item">
      <strong>L4 Wiener</strong> ‚Äì 20,000 pts ‚Üí +450/day<br>
      <button class="btn" onclick="buyMiner(4)">Buy</button>
    </div>
    <button class="btn" onclick="showPage('home')">Back Home</button>
  </div>

  <!-- SPIN -->
  <div id="spin" class="page">
    <h1>Lucky Spin</h1>
    <img src="https://i.ibb.co/4p4Y7hZ/wiener-cosmic-dachshund.png" style="width:120px;height:120px;border-radius:50%;">
    <h2>Bet 100 ‚Üí Win 0/50/500</h2>
    <div class="spin-wheel" id="wheel"></div>
    <button class="btn spin-btn" id="spin-btn" onclick="doSpin()">SPIN</button>
    <div id="spin-result" style="font-size:24px;margin:20px;color:#ffd700;"></div>
    <button class="btn" onclick="showPage('home')">Back Home</button>
  </div>

  <script>
    const tg = Telegram.WebApp;
    tg.ready(); tg.expand();
    const userId = tg.initDataUnsafe.user?.id || 'guest';
    const botUsername = 'WienerClickerBot';

    let game = {points:0, miners:{1:0,2:0,3:0,4:0}, lastDaily:'', streak:0, lastMineDate:''};

    const els = {
      points: document.getElementById('points'),
      miners: document.getElementById('miners'),
      pointsEarned: document.getElementById('points-earned'),
      dailyBtn: document.getElementById('daily-btn'),
      streak: document.getElementById('streak'),
      referralLink: document.getElementById('referral-link'),
      spinBtn: document.getElementById('spin-btn'),
      spinResult: document.getElementById('spin-result'),
      wheel: document.getElementById('wheel')
    };

    // Load & Init
    tg.CloudStorage.getItem('wienerDoge', (err, data) => {
      if (data) game = JSON.parse(data);
      update();
      checkDaily();
      updateReferralLink();
      collectMining(); // FIXED: Run on load
    });

    function tapWiener() {
      game.points += 0.1;
      createParticle('sparkles');
      tg.HapticFeedback.impactOccurred('light');
      update(); save();
    }

    function buyMiner(lvl) {
      const cost = [0,1000,5000,10000,20000][lvl];
      if (game.points >= cost) { game.points -= cost; game.miners[lvl]++; update(); save(); }
    }

    function claimDaily() {
      const today = new Date().toDateString();
      if (game.lastDaily !== today) {
        game.points += 10;
        game.streak = (game.lastDaily === new Date(Date.now()-86400000).toDateString()) ? game.streak + 1 : 1;
        game.lastDaily = today;
        els.dailyBtn.disabled = true; els.dailyBtn.innerText = "Claimed!";
        update(); save();
      }
    }

    function checkDaily() {
      const today = new Date().toDateString();
      els.streak.innerText = game.streak;
      if (game.lastDaily === today) { els.dailyBtn.disabled = true; els.dailyBtn.innerText = "Claimed!"; }
    }

    function collectMining() {
      const today = new Date().toDateString();
      if (game.lastMineDate !== today) {
        const rates = [0,50,100,200,450];
        let earned = 0;
        for (let i=1;i<=4;i++) earned += game.miners[i] * rates[i];
        game.points += earned;
        game.lastMineDate = today;
        els.pointsEarned.innerText = earned.toFixed(1);
        save();
      } else els.pointsEarned.innerText = '0.0';
      update();
    }

    function updateReferralLink() {
      els.referralLink.innerText = `https://t.me/${botUsername}?start=ref_${userId}`;
    }

    function copyReferral() { navigator.clipboard.writeText(els.referralLink.innerText).then(() => alert("Copied!")); }
    function shareReferral() { tg.shareUrl(els.referralLink.innerText, "Join WIENER DOGE!"); }

    function doSpin() {
      if (game.points < 100) return alert("Need 100 pts!");
      game.points -= 100; els.spinBtn.disabled = true; els.wheel.style.animationPlayState = 'running';
      setTimeout(() => {
        els.wheel.style.animationPlayState = 'paused';
        const r = Math.random();
        const win = r < 0.05 ? 500 : r < 0.20 ? 50 : 0;
        game.points += win;
        els.spinResult.innerText = win ? `+${win} pts!` : "Try again!";
        els.spinBtn.disabled = false;
        update(); save();
      }, 3000);
    }

    function createParticle(e) {
      const p = document.createElement('div');
      p.className = 'particle'; p.innerText = e;
      p.style.left = Math.random()*80+10+'vw'; p.style.top = '70vh';
      document.getElementById('particles').appendChild(p);
      setTimeout(() => p.remove(), 1000);
    }

    function update() {
      els.points.innerText = game.points.toFixed(1);
      els.miners.innerText = Object.values(game.miners).reduce((a,b)=>a+b,0);
    }

    function save() { tg.CloudStorage.setItem('wienerDoge', JSON.stringify(game)); }
    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if (id === 'home') collectMining();
    }

    setInterval(save, 10000);
    update();
  </script>
</body>
    </html>
  <!-- HOME -->
  <div id="home" class="page active">
    <h1>WIENER DOGE</h1>
    <img src="https://i.ibb.co/4p4Y7hZ/wiener-cosmic-dachshund.png" id="wifiener-img" onclick="tapWiener()">
    <div class="stat">
      <div>WIENER Points: <span id="points">0.0</span></div>
      <div>Miners: <span id="miners">0</span></div>
    </div>
    <div class="mining">
      <span>Today's Mining: </span><span id="points-earned">0.0</span>
    </div>
    <div class="nav">
      <button class="btn" onclick="showPage('daily')">Daily (+10)</button>
      <button class="btn" onclick="showPage('refer')">Refer (+50)</button>
      <button class="btn" onclick="showPage('shop')">Shop</button>
      <button class="btn" onclick="showPage('spin')">Lucky Spin</button>
    </div>
  </div>

  <!-- DAILY -->
  <div id="daily" class="page">
    <h1>Daily Check-in</h1>
    <img src="https://i.ibb.co/4p4Y7hZ/wiener-cosmic-dachshund.png" style="width:150px;height:150px;border-radius:50%;">
    <button class="btn" id="daily-btn" onclick="claimDaily()">Claim +10 Points!</button>
    <div id="daily-streak">Streak: <span id="streak">0</span> days</div>
    <button class="btn" onclick="showPage('home')">Back Home</button>
  </div>

  <!-- REFER -->
  <div id="refer" class="page">
    <h1>Refer & Earn</h1>
    <img src="https://i.ibb.co/4p4Y7hZ/wiener-cosmic-dachshund.png" style="width:150px;height:150px;border-radius:50%;">
    <p>Share ‚Üí +50 pts per friend!</p>
    <div id="referral-link">Loading...</div>
    <button class="btn" onclick="copyReferral()">Copy</button>
    <button class="btn" onclick="shareReferral()">Share</button>
    <button class="btn" onclick="showPage('home')">Back Home</button>
  </div>

  <!-- SHOP -->
  <div id="shop" class="page">
    <h1>Wiener Shop</h1>
    <img src="https://i.ibb.co/4p4Y7hZ/wiener-cosmic-dachshund.png" style="width:120px;height:120px;border-radius:50%;">
    <div class="shop-item">
      <strong>L1 Wiener</strong> ‚Äì 1000 pts ‚Üí +50/day<br>
      <button class="btn" onclick="buyMiner(1)">Buy</button>
    </div>
    <div class="shop-item">
      <strong>L2 Wiener</strong> ‚Äì 5000 pts ‚Üí +100/day<br>
      <button class="btn" onclick="buyMiner(2)">Buy</button>
    </div>
    <div class="shop-item">
      <strong>L3 Wiener</strong> ‚Äì 10,000 pts ‚Üí +200/day<br>
      <button class="btn" onclick="buyMiner(3)">Buy</button>
    </div>
    <div class="shop-item">
      <strong>L4 Wiener</strong> ‚Äì 20,000 pts ‚Üí +450/day<br>
      <button class="btn" onclick="buyMiner(4)">Buy</button>
    </div>
    <button class="btn" onclick="showPage('home')">Back Home</button>
  </div>

  <!-- SPIN -->
  <div id="spin" class="page">
    <h1>Lucky Spin</h1>
    <img src="https://i.ibb.co/4p4Y7hZ/wiener-cosmic-dachshund.png" style="width:120px;height:120px;border-radius:50%;">
    <h2>Bet 100 ‚Üí Win 0/50/500</h2>
    <div class="spin-wheel" id="wheel"></div>
    <button class="btn spin-btn" id="spin-btn" onclick="doSpin()">SPIN</button>
    <div id="spin-result" style="font-size:24px;margin:20px;color:#ffd700;"></div>
    <button class="btn" onclick="showPage('home')">Back Home</button>
  </div>

  <script>
    const tg = Telegram.WebApp;
    tg.ready(); tg.expand();
    const userId = tg.initDataUnsafe.user?.id || 'guest';
    const botUsername = 'WienerClickerBot';

    let game = {points:0, miners:{1:0,2:0,3:0,4:0}, lastDaily:'', streak:0, lastMineDate:''};

    const els = {
      points: document.getElementById('points'),
      miners: document.getElementById('miners'),
      pointsEarned: document.getElementById('points-earned'),
      dailyBtn: document.getElementById('daily-btn'),
      streak: document.getElementById('streak'),
      referralLink: document.getElementById('referral-link'),
      spinBtn: document.getElementById('spin-btn'),
      spinResult: document.getElementById('spin-result'),
      wheel: document.getElementById('wheel')
    };

    tg.CloudStorage.getItem('wienerDoge', (err, data) => {
      if (data) game = JSON.parse(data);
      update(); checkDaily(); updateReferralLink(); collectMining();
    });

    function tapWiener() {
      game.points += 0.1;
      createParticle('sparkles');
      tg.HapticFeedback.impactOccurred('light');
      update(); save();
    }

    function buyMiner(lvl) {
      const cost = [0,1000,5000,10000,20000][lvl];
      if (game.points >= cost) { game.points -= cost; game.miners[lvl]++; update(); save(); }
    }

    function claimDaily() {
      const today = new Date().toDateString();
      if (game.lastDaily !== today) {
        game.points += 10;
        game.streak = (game.lastDaily === new Date(Date.now()-86400000).toDateString()) ? game.streak + 1 : 1;
        game.lastDaily = today;
        els.dailyBtn.disabled = true; els.dailyBtn.innerText = "Claimed!";
        update(); save();
      }
    }

    function checkDaily() {
      const today = new Date().toDateString();
      els.streak.innerText = game.streak;
      if (game.lastDaily === today) { els.dailyBtn.disabled = true; els.dailyBtn.innerText = "Claimed!"; }
    }

    function collectMining() {
      const today = new Date().toDateString();
      if (game.lastMineDate !== today) {
        const rates = [0,50,100,200,450];
        let earned = 0;
        for (let i=1;i<=4;i++) earned += game.miners[i] * rates[i];
        game.points += earned;
        game.lastMineDate = today;
        els.pointsEarned.innerText = earned.toFixed(1);
        save();
      } else els.pointsEarned.innerText = '0.0';
      update();
    }

    function updateReferralLink() {
      els.referralLink.innerText = `https://t.me/${botUsername}?start=ref_${userId}`;
    }

    function copyReferral() { navigator.clipboard.writeText(els.referralLink.innerText); alert("Copied!"); }
    function shareReferral() { tg.shareUrl(els.referralLink.innerText, "Join WIENER DOGE!"); }

    function doSpin() {
      if (game.points < 100) return alert("Need 100 pts!");
      game.points -= 100; els.spinBtn.disabled = true; els.wheel.style.animationPlayState = 'running';
      setTimeout(() => {
        els.wheel.style.animationPlayState = 'paused';
        const r = Math.random();
        const win = r < 0.05 ? 500 : r < 0.20 ? 50 : 0;
        game.points += win;
        els.spinResult.innerText = win ? `+${win} pts!` : "Try again!";
        els.spinBtn.disabled = false;
        update(); save();
      }, 3000);
    }

    function createParticle(e) {
      const p = document.createElement('div');
      p.className = 'particle'; p.innerText = e;
      p.style.left = Math.random()*80+10+'vw'; p.style.top = '70vh';
      document.getElementById('particles').appendChild(p);
      setTimeout(() => p.remove(), 1000);
    }

    function update() {
      els.points.innerText = game.points.toFixed(1);
      els.miners.innerText = Object.values(game.miners).reduce((a,b)=>a+b,0);
    }

    function save() { tg.CloudStorage.setItem('wienerDoge', JSON.stringify(game)); }
    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if (id === 'home') collectMining();
    }

    setInterval(save, 10000);
    update();
  </script>
</body>
</html>
